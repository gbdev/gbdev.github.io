<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
          var u="//stats.gbdev.io/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><meta property="og:site_name" content="gbdev.io"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@gbdev0"><meta name="og:image" content="https://gbdev.io/images/gbinternals.png"><title>Adding a custom SGB border | gbdev.io</title><meta name="description" content="game boy development scene">
    <link rel="preload" href="/assets/style-zR1T1xg1.css" as="style"><link rel="stylesheet" href="/assets/style-zR1T1xg1.css">
    <link rel="modulepreload" href="/assets/app-CzVcYkYk.js"><link rel="modulepreload" href="/assets/sgb_border.html-CNXF3OxI.js">
    <link rel="prefetch" href="/assets/index.html-Ck62fYI6.js" as="script"><link rel="prefetch" href="/assets/chat.html-Bw01yCi3.js" as="script"><link rel="prefetch" href="/assets/contributing.html-rwBO9KjR.js" as="script"><link rel="prefetch" href="/assets/donate.html-BcuBItMw.js" as="script"><link rel="prefetch" href="/assets/gbcompo21.html-CiyJ6dVE.js" as="script"><link rel="prefetch" href="/assets/gbcompo23.html-D0PqW3wr.js" as="script"><link rel="prefetch" href="/assets/gbcompo25.html-CsP8SAsW.js" as="script"><link rel="prefetch" href="/assets/meetings.html-QWY8GhY9.js" as="script"><link rel="prefetch" href="/assets/newsletter.html-DBhJBDmy.js" as="script"><link rel="prefetch" href="/assets/privacypolicy.html-DF8JATGL.js" as="script"><link rel="prefetch" href="/assets/resources.html-Q_a_7aZA.js" as="script"><link rel="prefetch" href="/assets/to_c_or_not_to_c.html-MFU1wf5p.js" as="script"><link rel="prefetch" href="/assets/asmstyle.html-CT9no-pO.js" as="script"><link rel="prefetch" href="/assets/deadcscroll.html-D2lxGjmQ.js" as="script"><link rel="prefetch" href="/assets/dma_hijacking.html-un4YOB6x.js" as="script"><link rel="prefetch" href="/assets/lyc_timing.html-B1JFTTYt.js" as="script"><link rel="prefetch" href="/assets/tools.html-UNrrW2LX.js" as="script"><link rel="prefetch" href="/assets/2023-11-04-sc.html-CSZ5Vio5.js" as="script"><link rel="prefetch" href="/assets/2024-03-10-sc2.html-D7mObm3C.js" as="script"><link rel="prefetch" href="/assets/1.html-C94pPRbq.js" as="script"><link rel="prefetch" href="/assets/404.html-wrEeOASs.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">gbdev.io</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/resources.html" aria-label="Resources"><!--[--><!--[--><!--]--><!--]-->Resources<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Events"><span class="title">Events</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Events"><span class="title">Events</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/gbcompo25.html" aria-label="GB Competition 2025"><!--[--><!--[--><!--]--><!--]-->GB Competition 2025<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/gbcompo23.html" aria-label="GB Competition 2023"><!--[--><!--[--><!--]--><!--]-->GB Competition 2023<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/gbcompo21.html" aria-label="GB Competition 2021"><!--[--><!--[--><!--]--><!--]-->GB Competition 2021<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Projects"><span class="title">Projects</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Projects"><span class="title">Projects</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://hh.gbdev.io" aria-label="Homebrew Hub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Homebrew Hub<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://gbdev.io/pandocs" aria-label="Pan Docs" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Pan Docs<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://gbdev.io/gb-asm-tutorial" aria-label="GB ASM Tutorial" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GB ASM Tutorial<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://rgbds.gbdev.io/" aria-label="RGBDS" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->RGBDS<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Community"><span class="title">Community</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Community"><span class="title">Community</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/chat.html" aria-label="Chat channels"><!--[--><!--[--><!--]--><!--]-->Chat channels<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/meetings.html" aria-label="Meetings minutes"><!--[--><!--[--><!--]--><!--]-->Meetings minutes<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/donate.html" aria-label="Donations and Bounties"><!--[--><!--[--><!--]--><!--]-->Donations and Bounties<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/contributing.html" aria-label="Contribution Guidelines"><!--[--><!--[--><!--]--><!--]-->Contribution Guidelines<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/newsletter.html" aria-label="Newsletter"><!--[--><!--[--><!--]--><!--]-->Newsletter<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Guides"><span class="title">Guides</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/tools.html" aria-label="Choosing development tools"><!--[--><!--[--><!--]--><!--]-->Choosing development tools<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/asmstyle.html" aria-label="ASM Style recomendations"><!--[--><!--[--><!--]--><!--]-->ASM Style recomendations<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/lyc_timing.html" aria-label="The Timing of LYC STAT Handlers"><!--[--><!--[--><!--]--><!--]-->The Timing of LYC STAT Handlers<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://evie.gbdev.io/blog/interrupts.html" aria-label="Interrupts tutorial" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Interrupts tutorial<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://evie.gbdev.io/blog/understanding-structures.html" aria-label="Understanding Structures" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Understanding Structures<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/deadcscroll.html" aria-label="Dead C Scroll"><!--[--><!--[--><!--]--><!--]-->Dead C Scroll<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://eldred.fr/blog/2022/05/22/prehistorik" aria-label="The wonders of Prehistorik Man" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->The wonders of Prehistorik Man<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/dma_hijacking.html" aria-label="DMA Hijacking"><!--[--><!--[--><!--]--><!--]-->DMA Hijacking<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/guides/sgb_border.html" aria-label="Adding a custom SGB border"><!--[--><!--[--><!--]--><!--]-->Adding a custom SGB border<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://opencollective.com/gbdev" aria-label="Donate" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Donate<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/resources.html" aria-label="Resources"><!--[--><!--[--><!--]--><!--]-->Resources<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Events"><span class="title">Events</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Events"><span class="title">Events</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/gbcompo25.html" aria-label="GB Competition 2025"><!--[--><!--[--><!--]--><!--]-->GB Competition 2025<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/gbcompo23.html" aria-label="GB Competition 2023"><!--[--><!--[--><!--]--><!--]-->GB Competition 2023<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/gbcompo21.html" aria-label="GB Competition 2021"><!--[--><!--[--><!--]--><!--]-->GB Competition 2021<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Projects"><span class="title">Projects</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Projects"><span class="title">Projects</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://hh.gbdev.io" aria-label="Homebrew Hub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Homebrew Hub<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://gbdev.io/pandocs" aria-label="Pan Docs" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Pan Docs<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://gbdev.io/gb-asm-tutorial" aria-label="GB ASM Tutorial" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GB ASM Tutorial<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://rgbds.gbdev.io/" aria-label="RGBDS" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->RGBDS<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Community"><span class="title">Community</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Community"><span class="title">Community</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/chat.html" aria-label="Chat channels"><!--[--><!--[--><!--]--><!--]-->Chat channels<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/meetings.html" aria-label="Meetings minutes"><!--[--><!--[--><!--]--><!--]-->Meetings minutes<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/donate.html" aria-label="Donations and Bounties"><!--[--><!--[--><!--]--><!--]-->Donations and Bounties<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/contributing.html" aria-label="Contribution Guidelines"><!--[--><!--[--><!--]--><!--]-->Contribution Guidelines<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/newsletter.html" aria-label="Newsletter"><!--[--><!--[--><!--]--><!--]-->Newsletter<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Guides"><span class="title">Guides</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/tools.html" aria-label="Choosing development tools"><!--[--><!--[--><!--]--><!--]-->Choosing development tools<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/asmstyle.html" aria-label="ASM Style recomendations"><!--[--><!--[--><!--]--><!--]-->ASM Style recomendations<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/lyc_timing.html" aria-label="The Timing of LYC STAT Handlers"><!--[--><!--[--><!--]--><!--]-->The Timing of LYC STAT Handlers<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://evie.gbdev.io/blog/interrupts.html" aria-label="Interrupts tutorial" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Interrupts tutorial<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://evie.gbdev.io/blog/understanding-structures.html" aria-label="Understanding Structures" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Understanding Structures<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/deadcscroll.html" aria-label="Dead C Scroll"><!--[--><!--[--><!--]--><!--]-->Dead C Scroll<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://eldred.fr/blog/2022/05/22/prehistorik" aria-label="The wonders of Prehistorik Man" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->The wonders of Prehistorik Man<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/guides/dma_hijacking.html" aria-label="DMA Hijacking"><!--[--><!--[--><!--]--><!--]-->DMA Hijacking<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/guides/sgb_border.html" aria-label="Adding a custom SGB border"><!--[--><!--[--><!--]--><!--]-->Adding a custom SGB border<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://opencollective.com/gbdev" aria-label="Donate" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Donate<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Adding a custom SGB border <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="adding-a-custom-sgb-border" tabindex="-1"><a class="header-anchor" href="#adding-a-custom-sgb-border"><span>Adding a custom SGB border</span></a></h1><p>This document aims to help developers of DMG-compatible homebrew with adding Super Game Boy borders.</p><p>We will see how to:</p><ul><li>Detect whether the program is running on a SGB</li><li>Transfer the border&#39;s tiles</li><li>Transfer and display the border&#39;s tilemap and palettes</li></ul><small><p>Written by <strong>sylvie (zlago)</strong>, idea (and minor help) by <a href="https://coffeebat.neocities.org/" target="_blank" rel="noopener noreferrer">valentina (coffee bat)</a>, reviews and improvements by <a href="https://eldred.fr" target="_blank" rel="noopener noreferrer">ISSOtm</a>, <a href="https://github.com/avivace" target="_blank" rel="noopener noreferrer">avivace</a>, and <a href="https://github.com/pinobatch" target="_blank" rel="noopener noreferrer">PinoBatch</a>.</p></small><h2 id="enabling-sgb-features" tabindex="-1"><a class="header-anchor" href="#enabling-sgb-features"><span>Enabling SGB features</span></a></h2><p>Before we can do anything else, we must first specify in the header that this game is aware of SGB features. Otherwise, the SGB BIOS will ignore any packets we send, and we won&#39;t even be able to detect when the program is running on SGB.</p><p>To enable SGB features:</p><ul><li>The <a href="https://gbdev.io/pandocs/The_Cartridge_Header#0146--sgb-flag" target="_blank" rel="noopener noreferrer">SGB flag</a> must be set to <code>$03</code>;</li><li>The <a href="https://gbdev.io/pandocs/The_Cartridge_Header#014b--old-licensee-code" target="_blank" rel="noopener noreferrer">old licensee code</a> must be set to <code>$33</code>.</li></ul><p>This can be achieved by passing the <code>--sgb-compatible</code> and <code>--old-licensee 0x33</code> flags to <a href="https://rgbds.gbdev.io/docs/rgbfix.1" target="_blank" rel="noopener noreferrer"><code>rgbfix</code></a>.</p><h2 id="packets" tabindex="-1"><a class="header-anchor" href="#packets"><span>Packets</span></a></h2><p>The SGB BIOS can be &quot;talked to&quot; via <em>command packets</em>, sent bit by bit via the <code>P1</code>/<code>JOYP</code> register.</p><p>An SGB packet consists of:</p><ul><li>a &quot;start&quot; pulse (<code>P1</code>=<code>%xx00xxxx</code>)</li><li>128 data pulses (<code>P1</code>=<code>%xx01xxxx</code> for &quot;1&quot;, <code>P1</code>=<code>%xx10xxxx</code> for &quot;0&quot;)</li><li>a &quot;0&quot; pulse (<code>P1</code>=<code>%xx10xxxx</code>)</li></ul><p>You must set <code>P1</code> to <code>%xx11xxxx</code> between each pulse.</p><p>This adds up to 16 bytes of data (LSB first). If a packet doesn&#39;t read all 16 bytes, the unused bytes are ignored.</p><p><strong>You should wait 4 frames between each packet and the next.</strong> This gives the SGB BIOS a chance to receive a packet even if it is doing something else time-consuming.</p><p>For an example of such routine, see the related Pan Docs entry: <a href="https://gbdev.io/pandocs/SGB_Command_Packet.html" target="_blank" rel="noopener noreferrer">SGB Command Packet on Pandocs</a>.</p><p>This guide glosses over a minor detail, as certain packets can be (albeit unccomon) more than 16 bytes.</p><h2 id="trn" tabindex="-1"><a class="header-anchor" href="#trn"><span>TRN</span></a></h2><p>Bulk transfer (TRN) packets tell the SGB to copy the contents of the screen to buffers in Super NES work RAM. The <code>CHR_TRN</code> and <code>PCT_TRN</code> packets are used to send data for SGB borders.</p><p>For a transfer to function properly, you must prepare VRAM and the LCD registers:</p><ol><li>set <code>BGP</code> to <code>$e4</code> and <code>LCDC</code> to <code>$91</code> (screen enabled, BG uses tiles <code>$8000</code>-<code>$8fff</code> and tilemap <code>$9800</code>, WIN and OBJ disabled, BG enabled)</li><li>set <code>SCX</code> and <code>SCY</code> to <code>$00</code></li><li>the tilemap consists of <code>$00</code>, <code>$01</code>..<code>$13</code>, 12 bytes padding (offscreen), <code>$14</code>..<code>$27</code>, padding, repeat until <code>$ff</code> (inclusive)</li><li>the data you want to send must be loaded at <code>$8000</code>-<code>$8fff</code></li></ol><p>You can do 1, 2 and 3 via <a href="https://github.com/gb-archive/snek-gbc/blob/main/code/init.sm83#L208-L230" target="_blank" rel="noopener noreferrer">this snippet</a></p><ul><li><strong>You must load the data into VRAM and enable the screen before sending the TRN packet.</strong> The SGB reads TRN payloads from the screen. If rendering is off, there is nothing on the screen to read.</li><li><strong>You must wait ~8 frames after each TRN</strong> instead of just 4. The SGB BIOS has to finish what it&#39;s doing, receive the packet, and then read the screen.</li></ul><h2 id="detecting-sgb" tabindex="-1"><a class="header-anchor" href="#detecting-sgb"><span>Detecting SGB</span></a></h2><p>Here&#39;s how a SGB detection routine should look like:</p><ol><li>Wait 12 or more frames for the SGB BIOS to start listening for packets.</li><li>Send a <code>MLT_REQ</code> packet selecting 2 or 4 players (<code>$89, $01</code> or <code>$89, $03</code>), and wait a couple frames for the SGB to receive the packet.</li><li>Read the controller. Set <code>P1</code> bit 5 to 0, then set <code>P1</code> bits 5 and 4 to <code>%11</code> (<code>%xx11xxxx</code>) to release the key matrix.</li><li>Read the low nibble (bits 3-0) of <code>P1</code>, and look for a value other than <code>%1111</code> (which indicates player 1).</li><li>If player 1 was still found, repeat steps 3 and 4 once more, in case the next read indicates player 2.</li><li>Optionally turn off multiplayer mode.</li></ol><p>If a non-<code>%1111</code> value was found in step 4 either time, the program is running on SGB.</p><p>A routine like this may be used to detect SGB (modified from <a href="https://github.com/gb-archive/snek-gbc/blob/main/code/init.sm83#L167-L196" target="_blank" rel="noopener noreferrer">source</a>):</p><div class="language-sm83asm line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sm83asm"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff;"><code><span class="line"><span class="line"><span>SGB_Detect:</span></span></span>
<span class="line"><span class="line"><span>  ; test for SGB</span></span></span>
<span class="line"><span class="line"><span>  di</span></span></span>
<span class="line"><span class="line"><span>  call SGB_Wait4Frames</span></span></span>
<span class="line"><span class="line"><span>  call SGB_Wait4Frames</span></span></span>
<span class="line"><span class="line"><span>  call SGB_Wait4Frames</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>  ; Send MLT_REQ packet to enable multiplayer</span></span></span>
<span class="line"><span class="line"><span>  ld hl, Packets.mltOn  ; send MLT_REQ for 2 players</span></span></span>
<span class="line"><span class="line"><span>  call SGB_SendPacket</span></span></span>
<span class="line"><span class="line"><span>  call SGB_Wait4Frames</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>  ; Detect the SGB by checking if SGB responded to MLT_REQ.</span></span></span>
<span class="line"><span class="line"><span>  ; Setting P1.5 to low then high advances the selected player.</span></span></span>
<span class="line"><span class="line"><span>  ; Setting P1.4 and P1.5 high causes the ICD2 to reflect the</span></span></span>
<span class="line"><span class="line"><span>  ; selected player in low bits of P1.</span></span></span>
<span class="line"><span class="line"><span>  ld b, 4              ; Number of attempts</span></span></span>
<span class="line"><span class="line"><span>  ld c, LOW(rP1)       ; Address to write</span></span></span>
<span class="line"><span class="line"><span>  .loop</span></span></span>
<span class="line"><span class="line"><span>    ld a, P1F_4        ; Try to advance player</span></span></span>
<span class="line"><span class="line"><span>    ldh [c], a</span></span></span>
<span class="line"><span class="line"><span>    ld a, P1F_4|P1F_5  ; Set P1 to return the selected player</span></span></span>
<span class="line"><span class="line"><span>    ldh [c], a</span></span></span>
<span class="line"><span class="line"><span>    ; In case this is DMG and not SGB, let the input lines settle</span></span></span>
<span class="line"><span class="line"><span>    ; for a few cycles before reading P1 again</span></span></span>
<span class="line"><span class="line"><span>    call SGB_Wait4Frames.knownRet</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>    ldh a, [c]         ; Player 1 has A.0 = 1; players 2 and 4 have A.0 = 0</span></span></span>
<span class="line"><span class="line"><span>    cpl                ; Invert this</span></span></span>
<span class="line"><span class="line"><span>    and %00000001      ; Keep only bit 0, which is 0 for player 1 or nonzero for players 2 and 4</span></span></span>
<span class="line"><span class="line"><span>    jr nz, .done</span></span></span>
<span class="line"><span class="line"><span>    dec b              ; Keep trying until we&#39;ve cycled through all players</span></span></span>
<span class="line"><span class="line"><span>    jr nz, .loop</span></span></span>
<span class="line"><span class="line"><span>  .done</span></span></span>
<span class="line"><span class="line"><span>  ; After this loop, A is $01 for SGB or $00 for not SGB.  Remember this</span></span></span>
<span class="line"><span class="line"><span>  ld [wIsSGB], a</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>  ; (Optional) Disable multiplayer</span></span></span>
<span class="line"><span class="line"><span>  ld hl, Packets.mltOff  ; send MLT_REQ for 2 players</span></span></span>
<span class="line"><span class="line"><span>  call nz, SGB_SendPacket</span></span></span>
<span class="line"><span class="line"><span>  ret</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>SGB_Wait4Frames:</span></span></span>
<span class="line"><span class="line"><span>  ld bc, -(456 * 154 / 16 * 4)</span></span></span>
<span class="line"><span class="line"><span>  .loop</span></span></span>
<span class="line"><span class="line"><span>    inc c  ; inner loop takes 16 T-states per iteration</span></span></span>
<span class="line"><span class="line"><span>    jr nz, .loop</span></span></span>
<span class="line"><span class="line"><span>    inc b</span></span></span>
<span class="line"><span class="line"><span>    jr nz, .loop</span></span></span>
<span class="line"><span class="line"><span>  .knownRet</span></span></span>
<span class="line"><span class="line"><span>  ret</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sgb-detection-notes" tabindex="-1"><a class="header-anchor" href="#sgb-detection-notes"><span>SGB detection notes</span></a></h3><ul><li>It would be a good idea to save somewhere in RAM whether the game is running on an SGB capable device or not, such that if you wish to change the border mid-gameplay, you won&#39;t have to perform SGB detection again. The sample code stores it in <code>wIsSGB</code>.</li><li><strong>If you wish to only use 1 controller for the game, you will have to send another <code>MLT_REQ</code> to disable multiplayer</strong> (<code>$89, $00</code>)</li><li><code>SGB_Wait4Frames</code> above uses busy waiting. Depending on the structure of your initialization code, you can change it to use vblank interrupts or <code>di</code>+<code>halt</code> instead.</li></ul><h2 id="border-limitations" tabindex="-1"><a class="header-anchor" href="#border-limitations"><span>Border limitations</span></a></h2><p>An SGB border has:</p><ul><li>255 tiles + 1 transparent tile (preferably tile #0)</li><li>3 palettes of 15 (+ 1 transparent) colors, (up to 45 solid colors total)</li><li>a 256Ã—224-pixel tilemap (there&#39;s a bit more to this, see <a href="#notes">notes</a>)</li></ul><h2 id="converting-borders" tabindex="-1"><a class="header-anchor" href="#converting-borders"><span>Converting borders</span></a></h2><p>With a recent version of <a href="https://github.com/Optiroc/SuperFamiconv" target="_blank" rel="noopener noreferrer">superfamiconv</a>:</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">superfamiconv</span><span style="color:#A3BE8C;"> -v</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> input.png</span><span style="color:#A3BE8C;"> -p</span><span style="color:#A3BE8C;"> output.pal</span><span style="color:#A3BE8C;"> -t</span><span style="color:#A3BE8C;"> output.4bpp</span><span style="color:#A3BE8C;"> -P</span><span style="color:#B48EAD;"> 4</span><span style="color:#A3BE8C;"> -m</span><span style="color:#A3BE8C;"> output.pct</span><span style="color:#A3BE8C;"> -M</span><span style="color:#A3BE8C;"> snes</span><span style="color:#A3BE8C;"> --color-zero</span><span style="color:#A3BE8C;"> 0000ff</span><span style="color:#A3BE8C;"> -B</span><span style="color:#B48EAD;"> 4</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>--color-zero</code> should be the color that your image for transparency, in my case it was blue. <ul><li>If your image has an alpha channel, it can be set can also be set to <code>00000000</code> to use the actual transparent color; however, this may cause some issues.</li></ul></li><li><code>-v</code> is optional, for showing details of the conversion process</li><li>You can add a row of the transparent color at the top of the image to force superfamiconv to make it tile #0, then <code>incbin &quot;output.pct&quot;, 64</code> to leave out that row.</li><li><code>-P 4</code> sets the base palette to the 4th one, and <strong>SGB borders use SNES palettes 4, 5, and 6.</strong> as of writing this, this option only works if you built superfamiconv from source.</li></ul><h2 id="uploading-borders" tabindex="-1"><a class="header-anchor" href="#uploading-borders"><span>Uploading borders</span></a></h2><p>As stated before, the SGB border consists of tile data, picture data, and palette data. These are split across 2-3 packets:</p><ul><li><p><code>CHR_TRN</code> (<code>$99</code>) is used to send 4KiB of tile data.</p><ul><li>since the border can use up to 8KiB of tiles, bit 0 of the second byte specifies which &quot;half&quot; you&#39;re sending <ul><li><code>$99, $00</code> if the screen is loaded with the first 4KiB of tile data</li><li><code>$99, $01</code> if the screen is loaded with the second 4KiB of tile data</li></ul></li></ul></li><li><p><code>PCT_TRN</code> (<code>$a1</code>) is used to send the picture and palette data. it also swaps the border, generally a good idea to send it after the tile data[^1]</p><ul><li>assuming tiles <code>0</code>-<code>255</code> use VRAM from <code>$8000</code> to <code>$8fff</code>: <ul><li>the picture data must be at <code>$8000</code>-<code>$873f</code> (last 64 bytes are <em>usually</em> offscreen, see <a href="#notes">notes</a>)</li><li>palette data must be at <code>$8800</code>-<code>$885f</code></li><li>everything else is ignored <ul><li>how you skip putting data at <code>$8740</code>-<code>$87ff</code> is up to you, I prefer doing separate copies, others prefer copying tilemap and palette data in one go, with the area between them padded.</li></ul></li></ul></li></ul></li></ul><p>See also the related Pan Docs entry: <a href="https://gbdev.io/pandocs/SGB_Command_Border.html" target="_blank" rel="noopener noreferrer">SGB Command Border</a>.</p><p>[^1]: You can send a <code>CHR_TRN</code> <a href="https://github.com/pinobatch/little-things-gb/blob/b11b554d73c48a0f54fee0df31e59eb83806fcb4/sgbears/docs/long_story.md" target="_blank" rel="noopener noreferrer">up to ~60 frames</a> after the <code>PCT_TRN</code> for it to apply to the current border, but not all emulators will emulate this. It&#39;s fine to just pretend <code>CHR_TRN</code>s must go before <code>PCT_TRN</code>.</p><h2 id="notes" tabindex="-1"><a class="header-anchor" href="#notes"><span>Notes</span></a></h2><ol><li><p>You can set the first row of tiles to your transparent color to force superfamiconv to put the transparent tile as the 1st tile, however you must then exclude 64 bytes of the tilemap (<code>incbin &quot;border.pct&quot;</code> -&gt; <code>incbin &quot;border.pct&quot;, 64</code>)</p></li><li><p>SGB BIOS reserves palettes 4 through 6 for borders. If you really know what you&#39;re doing, you may be able to use palette 0 (the gameplay palette) for animated borders. You will probably have to edit the border in a tile editor such as YY-CHR, as there aren&#39;t yet any other tools for that.</p></li><li><p>When the SNES lags, scanline 225 of the SGB border will be visible! You can set the topmost row of the 29th row of tiles to black to hide this.</p></li><li><p>If this doesn&#39;t work for you, you can ask for help on the <a href="https://gbdev.io/chat.html" target="_blank" rel="noopener noreferrer">gbdev</a> channels.</p></li></ol></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/gbdev/gbdev.github.io/edit/dev/website/guides/sgb_border.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--[--><div class="my-footer"><hr><a href="/privacypolicy.html">Privacy Policy </a> - <a href="/donate.html#sponsoring">Sponsors </a><br><a href="https://www.digitalocean.com/" target="_blank"><img class="sponsor_logo" src="/assets/DO_Powered_by_Badge_blue-B-79VGip.svg"></a><a href="https://incube8games.com/" target="_blank" alt="Incube8 Games - Physical Retro Gaming Publisher"><img alt="Incube8 Games - Physical Retro Gaming Publisher" class="sponsor_logo incube8" src="/assets/Incube8-Games-Logo-Cl6LMdxo.png"></a></div><!--]--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CzVcYkYk.js" defer></script>
  </body>
</html>
